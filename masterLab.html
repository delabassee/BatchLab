<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the Batch API (JSR 352)</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<style>
/* Foundation stylesheet for CodeRay (to match GitHub theme) | MIT License | http://foundation.zurb.com */
table.CodeRay { border-collapse: collapse; padding: 2px; margin-bottom: 0; border: 0; background: transparent; }
table.CodeRay td { padding: 0 .5em; vertical-align: top; }
table.CodeRay td.line-numbers { text-align: right; color: #999; border-right: 1px solid #e5e5e5; padding-left: 0; }
span.line-numbers { border-right: 1px solid #E5E5E5; color: #999; display: inline-block; margin-right: 0.5em; padding-right: 0.5em; }
.CodeRay td.line-numbers strong, .CodeRay span.line-numbers strong { font-weight: normal; }
.CodeRay .debug { color: white !important; background: blue !important; }
.CodeRay .annotation { color: #007; }
.CodeRay .attribute-name { color: #f08; }
.CodeRay .attribute-value { color: #700; }
.CodeRay .binary { color: #509; }
.CodeRay .comment  { color: #999; font-style: italic; }
.CodeRay .char { color: #04D; }
.CodeRay .char .content { color: #04D; }
.CodeRay .char .delimiter { color: #039; }
.CodeRay .class { color: #458; }
.CodeRay .complex { color: #A08; }
.CodeRay .constant { color: teal; }
.CodeRay .color { color: #0A0; }
.CodeRay .class-variable { color: #369; }
.CodeRay .decorator { color: #B0B; }
.CodeRay .definition { color: #099; }
.CodeRay .directive { color: #088; }
.CodeRay .delimiter { color: black; }
.CodeRay .doc { color: #970; }
.CodeRay .doctype { color: #34b; }
.CodeRay .doc-string { color: #D42; }
.CodeRay .escape  { color: #666; }
.CodeRay .entity { color: #800; }
.CodeRay .error { color: #808; }
.CodeRay .exception { color: #C00; }
.CodeRay .filename { color: #099; }
.CodeRay .function { color: #900; }
.CodeRay .global-variable { color: teal; }
.CodeRay .hex { color: #058; }
.CodeRay .integer  { color: #099; }
.CodeRay .include { color: #B44; }
.CodeRay .inline { color: black; }
.CodeRay .inline .inline { background: #ccc; }
.CodeRay .inline .inline .inline { background: #bbb; }
.CodeRay .inline .inline-delimiter { color: #D14; }
.CodeRay .inline-delimiter { color: #D14; }
.CodeRay .important { color: #f00; }
.CodeRay .interpreted { color: #B2B; }
.CodeRay .instance-variable { color: teal; }
.CodeRay .label { color: #970; }
.CodeRay .local-variable { color: #963; }
.CodeRay .octal { color: #40E; }
.CodeRay .predefined { color: #369; }
.CodeRay .preprocessor { color: #579; }
.CodeRay .pseudo-class { color: #00C; }
.CodeRay .predefined-type { color: #074; }
.CodeRay .reserved, .keyword  { color: #000; }
.CodeRay .key { color: #808; }
.CodeRay .key .delimiter { color: #606; }
.CodeRay .key .char { color: #80f; }
.CodeRay .value { color: #088; }
.CodeRay .regexp { background-color: #fff0ff; }
.CodeRay .regexp .content { color: #808; }
.CodeRay .regexp .delimiter { color: #404; }
.CodeRay .regexp .modifier { color: #C2C; }
.CodeRay .regexp .function  { color: #404; font-weight: bold; }
.CodeRay .string { color: #D20; }
.CodeRay .string .string { }
.CodeRay .string .string .string { background-color: #ffd0d0; }
.CodeRay .string .content { color: #D14; }
.CodeRay .string .char { color: #D14; }
.CodeRay .string .delimiter { color: #D14; }
.CodeRay .shell { color: #D14; }
.CodeRay .shell .content { }
.CodeRay .shell .delimiter { color: #D14; }
.CodeRay .symbol { color: #990073; }
.CodeRay .symbol .content { color: #A60; }
.CodeRay .symbol .delimiter { color: #630; }
.CodeRay .tag, .CodeRay .attribute-name { color: #070; }
.CodeRay .tag-special { color: #D70; }
.CodeRay .type { color: #339; }
.CodeRay .variable  { color: #036; }
.CodeRay .insert { background: #afa; }
.CodeRay .delete { background: #faa; }
.CodeRay .change { color: #aaf; background: #007; }
.CodeRay .head { color: #f8f; background: #505; }
.CodeRay .insert .insert { color: #080; }
.CodeRay .delete .delete { color: #800; }
.CodeRay .change .change { color: #66f; }
.CodeRay .head .head { color: #f4f; }

</style>
</head>
<body class="book">
<div id="header">
<h1>Introduction to the Batch API (JSR 352)</h1>
<span id="author" class="author">David Delabassee</span><br>
<span id="email" class="email"><a href="https://twitter.com/delabassee">@delabassee</a></span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">Aug 27, 2014</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="pic/cover.jpg" alt="cover">
</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_software_requirements">Software Requirements</a></li>
<li><a href="#_lab_overview">Lab Overview</a></li>
<li><a href="#_where_to_get_help">Where to get help</a></li>
<li><a href="#_important_note">Important note</a></li>
</ul>
</li>
<li><a href="#_lab_jsr_352_introduction">1. Lab: JSR 352 introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_set_the_stage">1.1. Set the stage</a></li>
<li><a href="#_data_and_data_store">1.2. Data and Data Store</a></li>
<li><a href="#_payroll_job_the_reader_the_processor_the_writer">1.3. PayRoll Job : the Reader, the Processor, the Writer</a></li>
<li><a href="#_putting_all_the_pieces_together_jsl">1.4. Putting all the pieces together : JSL</a></li>
<li><a href="#_executing_the_job">1.5. Executing the Job</a></li>
<li><a href="#_testing_the_payroll_application">1.6. Testing the Payroll application</a></li>
<li><a href="#_summary">1.7. Summary</a></li>
</ul>
</li>
<li><a href="#_lab_batchlet_and_multi_steps_job">2. Lab: Batchlet and Multi-steps Job</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_set_the_stage_2">2.1. Set the stage</a></li>
<li><a href="#_implement_the_batchlet_step">2.2. Implement the Batchlet step</a></li>
<li><a href="#_update_the_jsl">2.3. Update the JSL</a></li>
<li><a href="#_testing_the_payroll_application_2">2.4. Testing the Payroll application</a></li>
<li><a href="#_summary_2">2.5. Summary</a></li>
</ul>
</li>
<li><a href="#_lab_checkpoints_and_the_joboperator_interface">3. Lab: Checkpoints and the JobOperator interface</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_set_the_stage_3">3.1. Set the stage</a></li>
<li><a href="#_start_a_job">3.2. Start a job</a></li>
<li><a href="#_break_the_job">3.3. Break the job!</a></li>
<li><a href="#_resume_a_failed_job">3.4. Resume a failed job</a></li>
<li><a href="#_summary_3">3.5. Summary</a></li>
</ul>
</li>
<li><a href="#_lab_listeners">4. Lab: Listeners</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_set_the_stage_4">4.1. Set the stage</a></li>
<li><a href="#_defining_a_listener_at_the_job_level">4.2. Defining a listener at the Job level</a></li>
<li><a href="#_defining_listener_s_at_the_step_level">4.3. Defining listener(s) at the Step level</a></li>
<li><a href="#_defining_listener_s_within_a_step">4.4. Defining listener(s) within a Step</a></li>
<li><a href="#_summary_4">4.5. Summary</a></li>
</ul>
</li>
<li><a href="#_lab_job_partitioning">5. Lab: Job Partitioning</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_set_the_stage_5">5.1. Set the stage</a></li>
<li><a href="#_define_the_partition_strategy">5.2. Define the partition strategy</a></li>
<li><a href="#_partition_aware_reader">5.3. Partition aware reader</a></li>
<li><a href="#_test_the_partitioned_execution">5.4. Test the partitioned execution</a></li>
<li><a href="#_summary_5">5.5. Summary</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Batch processing is used in many industries for tasks ranging from payroll processing; statement generation; end-of-day jobs such as interest calculation, ETL (extract, load, and transform) in a data warehouse; and many more. Typically, batch processing is bulk-oriented, non-interactive, and long running and might be data or computation-intensive. Batch jobs can be run on schedule or initiated on demand. Also, since batch jobs are typically long-running jobs, check-pointing and restarting are common features found in batch jobs.</p>
</div>
<div class="paragraph">
<p>JSR 352 (Batch Processing for Java Platform), part of the Java EE 7 platform, defines the programming model for batch applications and the runtime to run and manage batch jobs. This Hands-on Lab will take you through the key concepts of JSR352.</p>
</div>
<div class="sect2">
<h3 id="_software_requirements">Software Requirements</h3>
<div class="paragraph">
<p>The following software are needed for this Lab.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
JavaOne attendees, everything has been installed and pre-configured for you!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java SE</strong>: JDK 7 or JDK 8 is required. The JDK can be downloaded from
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</p>
</li>
<li>
<p><strong>Java EE 7 Application Server</strong>: This Lab uses the latest release of GlassFish, i.e. GlassFish Server Open Source Edition 4.1 (GF 4.0 should also work). Any other Java EE 7 (Full Platform) Application Server should work as well. Since JSR 352 is part of the Full Platform, this lab will not run on a Java EE 7 Web Profile Application Server.</p>
</li>
<li>
<p><strong>IDE</strong>: This Lab uses NetBeans 8.0 but any IDE supporting Java EE 7 should work.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lab_overview">Lab Overview</h3>
<div class="paragraph">
<p>This Lab is divided in 5 exercises :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lab 1</strong> will introduce you the main concepts of JSR 352 such as Step, Job, JSL, etc. In this exercise, you will be guided to build from scratch a complete application that will run a simple batch job to perform some hypothetical payroll calculations.</p>
</li>
<li>
<p><strong>Lab 2</strong> will enhance the first exercise and introduce mutli-steps jobs combining Chunk step with a Batchlet step..</p>
</li>
<li>
<p><strong>Lab 3</strong> will cover checkpoint and the JobOperator interface which can be used to resume failed job.</p>
</li>
<li>
<p><strong>Lab 4</strong> will build introduce you to listeners, a mechanism that can be used to intervene within the life-cycle of a batch job (e.g. to catch errors).</p>
</li>
<li>
<p><strong>Lab 5</strong> will introduce the concept of Job Partitioning, a more advanced feature of JSR 352.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unless you are already familiar with the Batch API, it is recommended to follow the suggested exercises order.</p>
</div>
</div>
<div class="sect2">
<h3 id="_where_to_get_help">Where to get help</h3>
<div class="paragraph">
<p>Here are some advices if you are stuck during the Lab&#8230;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that your imports are correct, e.g. a <code>java.util.list</code> is not really a <code>java.awt.list</code> !</p>
</li>
<li>
<p>Make sure that the code you have copy/pasted is correct and complete.</p>
</li>
<li>
<p>If your code doesn&#8217;t compile, NetBeans will show where the error is and will also provide some suggestions on how it could be fixed.</p>
</li>
<li>
<p>It is sometime useful to re-read a section from the beginning.</p>
</li>
<li>
<p>The solutions should be used as a final resort to to pinpoints hard to find issues.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At any time, feel free to ask a JavaOne Proctor, they are here to help you!</p>
</div>
</div>
<div class="sect2">
<h3 id="_important_note">Important note</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The sample applications and the code may not always be following best practices (e.g. data validation, correct error handling, leverage the lastest Java SE features, etc.). This is intentional such as to stay focused on explaining JSR 352. It is highly recommended to make sure that the code copied from this lab is updated to meet the requirements of any production application!
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_jsr_352_introduction">1. Lab: JSR 352 introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise will introduce you the main concepts of JSR 352 : Step, Job, Job Specification Language, batch runtime, etc. You will build a complete application that will run a simple batch job performing some hypothetical salary calculations. The application has been intentionally kept quite simple in order to focus on the key concepts of JSR 352.</p>
</div>
<div class="sect2">
<h3 id="_set_the_stage">1.1. Set the stage</h3>
<div class="paragraph">
<p>By nature Batch Job are long-lived and doesn&#8217;t require human intervention. Nevertheless in our exercise, we will use a Servlet to interact with the Batch API (e.g. start the Job, get the status of the Job, etc.).</p>
</div>
<div class="sect3">
<h4 id="_create_the_project">1.1.1. Create the project</h4>
<div class="paragraph">
<p>In the NetBeans Projects window, right click and select "New Project&#8230;".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.1.jpg" alt="E1.1">
</div>
<div class="title">Figure 1. NetBeans Project Windows</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_web_application">1.1.2. Create the Web Application</h4>
<div class="paragraph">
<p>We will now create a Web Application so select "Web Application" in the "Java Web" category. Note that a Web Application in NetBeans parlance is just the project structure of a typical Web Application.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use the filter option at the top of the "New Project" window to filter out options from NetBeans, e.g. type "web" to easily find the "Web Application" project type.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.2.jpg" alt="E1.2">
</div>
<div class="title">Figure 2. Create a Project &amp; NetBeans Filter</div>
</div>
<div class="paragraph">
<p>Click "Next" and give your project a relevant name (e.g. "Lab1"). You can leave the other suggested values (Location &amp; Folder) as they are. Click "Finish" and you should now have an empty Web Application (project structure and a single JSP page).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.3.jpg" alt="E1.3">
</div>
<div class="title">Figure 3. TO CHECK</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_package">1.1.3. Create the Package</h4>
<div class="paragraph">
<p>You should now create the package to host the application code. Right click in your project, select "New" and "Java Package" and name your package "org.glassfish.batch.lab1". All our codes will reside in this package.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.4.jpg" alt="E1.4">
</div>
<div class="title">Figure 4. Create a New Package</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
It is possible that your menu is slightly different. If you don&#8217;t find the "Java Package&#8230;" option, just select "Other&#8230;" at the bottom of the menu and use the filter.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_servlet">1.1.4. Create the Servlet</h4>
<div class="paragraph">
<p>We will now create the Servlet itself. As usual, use NetBeans "New" menu and select "Servlet" from the "Web" category. Click "Next" and make sure to select, using the drop-down list, the package we have defined in the previous step (see Figure 6). You can click "Finish" as we are, for the rest, using the default values.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.6.jpg" alt="E1.6">
</div>
<div class="title">Figure 5. Create the Servlet</div>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.7.jpg" alt="E1.7">
</div>
<div class="title">Figure 6. Select the right package for your Servlet</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can now right click on your Servlet class and select "Run File". If everything goes well, your Servlet will be compiled and deployed to GlassFish. NetBeans will then invoke your web browser to connect to your Servlet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_and_data_store">1.2. Data and Data Store</h3>
<div class="paragraph">
<p>A typical enterprise application needs some data to consume. In real life, those data are  high likely stored in a database, received over the network (eg. through a REST endpoint) or via a JMS Queue, etc.</p>
</div>
<div class="paragraph">
<p>Our exercise also needs some data but for the sake of simplicity, we will mock a data producer behind a simple Singleton EJB as the focus of the Lab is really on the Batch API and not so much on other APIs such as JPA or JAX-RS.</p>
</div>
<div class="sect3">
<h4 id="_create_the_the_input_record">1.2.1. Create the the Input Record</h4>
<div class="paragraph">
<p>Let&#8217;s now create a simple class that will be used as input record for the  application.
This class is very simple, it holds an employee Id and some simple methods (e.g. get and set the employee salary).</p>
</div>
<div class="paragraph">
<p>In the Project Window, select "New", "Java Class" from the "Java" category and click "Next". Name the class "PayrollInputRecord" and make sure it&#8217;s in the correct package ("org.glassfish.batch.lab1"). Click "Finish" to actually create the class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.8.jpg" alt="E1.8">
</div>
<div class="title">Figure 7. Create a new Java class</div>
</div>
<div class="paragraph">
<p>Add the following code to the body of the class :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> id;

    <span class="directive">private</span> <span class="predefined-type">String</span> salary;

    <span class="directive">public</span> PayrollInputRecord(<span class="type">int</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="directive">public</span> <span class="type">int</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getSalary() {
        <span class="keyword">return</span> salary;
    }

    <span class="directive">public</span> <span class="type">void</span> setSalary(<span class="predefined-type">String</span> salary) {
        <span class="local-variable">this</span>.salary = salary;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> id;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> object) {
        <span class="keyword">if</span> (object == <span class="predefined-constant">null</span> || !(object <span class="keyword">instanceof</span> PayrollInputRecord)) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        PayrollInputRecord other = (PayrollInputRecord) object;
        <span class="keyword">return</span> <span class="local-variable">this</span>.id == other.id;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollInputRecord[ id=</span><span class="delimiter">&quot;</span></span> + id + <span class="string"><span class="delimiter">&quot;</span><span class="content"> ]</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
When you save a class, NetBeans will try to recompile it. If it can&#8217;t, you will easily then see where the errors are.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_the_output_record">1.2.2. Create the the Output Record</h4>
<div class="paragraph">
<p>Similarly, we will now create a simple class that will be used as output record.
This class adds some capabilities (set and get the employee social security number, his/her bonus, etc.)</p>
</div>
<div class="paragraph">
<p>In the Project Window, select "New", "Java Class" from the "Java" category and click "Next". Name the class "PayrollOutputRecord", check the package ("org.glassfish.batch.lab1") and click "Finish".</p>
</div>
<div class="paragraph">
<p>Add this code to the class :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> empId;

    <span class="directive">private</span> <span class="type">float</span> salary;

    <span class="directive">private</span> <span class="type">float</span> socialSecurityTax;

    <span class="directive">private</span> <span class="type">float</span> bonus = <span class="integer">0</span>;

    <span class="directive">private</span> <span class="type">float</span> net;

    <span class="directive">public</span> PayrollOutputRecord(<span class="type">int</span> empID) {
        <span class="local-variable">this</span>.empId = empID;
    }

    <span class="directive">public</span> <span class="type">int</span> getEmpId() {
        <span class="keyword">return</span> empId;
    }

    <span class="directive">public</span> <span class="type">float</span> getSalary() {
        <span class="keyword">return</span> salary;
    }

    <span class="directive">public</span> <span class="type">void</span> setSalary(<span class="type">float</span> base) {
        <span class="local-variable">this</span>.salary = base;
    }

    <span class="directive">public</span> <span class="type">float</span> getSocialSecurityTax() {
        <span class="keyword">return</span> socialSecurityTax;
    }

    <span class="directive">public</span> <span class="type">void</span> setSocialSecurityTax(<span class="type">float</span> socialSecurityTax) {
        <span class="local-variable">this</span>.socialSecurityTax = socialSecurityTax;
    }

    <span class="directive">public</span> <span class="type">float</span> getBonus() {
        <span class="keyword">return</span> bonus;
    }

    <span class="directive">public</span> <span class="type">void</span> setBonus(<span class="type">float</span> bonus) {
        <span class="local-variable">this</span>.bonus = bonus;
    }

    <span class="directive">public</span> <span class="type">float</span> getNet() {
        <span class="keyword">return</span> net;
    }

    <span class="directive">public</span> <span class="type">void</span> setNet(<span class="type">float</span> net) {
        <span class="local-variable">this</span>.net = net;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> getEmpId();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> object) {
        <span class="keyword">if</span> (object == <span class="predefined-constant">null</span> || !(object <span class="keyword">instanceof</span> PayrollOutputRecord)) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        PayrollOutputRecord other = (PayrollOutputRecord) object;
        <span class="keyword">return</span> getEmpId() == other.getEmpId();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollOutputRecord[ id= [</span><span class="delimiter">&quot;</span></span> + getEmpId() + <span class="string"><span class="delimiter">&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_ejb">1.2.3. Create the EJB</h4>
<div class="paragraph">
<p>We will create a simple Java class. We will then use some annotations to turn this POJO (Plain Old Java Object) into the Enterprise Java Beans we need.</p>
</div>
<div class="paragraph">
<p>In the Project Window, select "New", "Java Class" from the "Java" category and click "Next". Name the class "PayrollDataHolderBean" and make sure it&#8217;s in the correct package ("org.glassfish.batch.lab1")</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.5.jpg" alt="E1.5">
</div>
<div class="title">Figure 8. Create a java class</div>
</div>
<div class="paragraph">
<p>Add the following 2 annotations at the class level : <code>@Singleton</code> &amp; <code>@Startup</code> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Singleton</code> is used to specify that this class will be implements a singleton session bean. You will have to import <code>javax.ejb.Singleton</code>.</p>
</li>
<li>
<p><code>@Startup</code> is used to specify that this EJB will use eager initialization, i.e. the EJB container will initialise it upon application startup, before it can get any requests. This is useful, for example, to perform application startup tasks.
&#8230;</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.9.jpg" alt="E1.9">
</div>
<div class="title">Figure 9. Notice the yellow light bulb on the left and the red waved underlined line of code.</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
A waved red underlined line of code means that NetBeans is unable to compile that particular line. A light bulb on the left side of the code means that NetBeans has suggestions that could fix the issue. Right click on the magnifier to see and eventually select one of the proposed fix.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Right click on the light bulb to fix the imports. Check to top of the class file and you should now see the that the classes corresponding to the 2 annotations have been added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Startup</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following code to the body of the class :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; payrollInputRecords = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;PayrollOutputRecord&gt; payrollOutputRecords = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();

    <span class="directive">public</span> PayrollDataHolderBean() {

    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> onApplicationStartup() {
        <span class="keyword">for</span> (<span class="type">int</span> empID=<span class="integer">1</span>; empID&lt;<span class="integer">6</span>; empID++) {
            payrollInputRecords.add(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + empID + <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + (<span class="integer">80000</span> + empID*<span class="integer">10000</span>));
        }
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getPayrollInputData() {
        <span class="keyword">return</span> <span class="predefined-type">Collections</span>.unmodifiableList(payrollInputRecords);
    }

    <span class="directive">public</span> <span class="type">void</span> addPayrollOutputRecord(PayrollOutputRecord data) {
        payrollOutputRecords.add(data);
    }

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;PayrollOutputRecord&gt; getPayrollOutputRecords() {
        <span class="keyword">return</span> payrollOutputRecords;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, we define a <code>payrollInputRecords</code> list of strings. We use the <code>@PostConstruct</code> annotation to specify to the Application Server that the <code>onApplicationStartup()</code> method should be invoked after all injection has occurred and after all initializers have been called, i.e. before the EJB can handle client requests. This method basically fills the <code>payrollInputRecords</code> list with dummy employees data (an employee ID and numeric value, stored in a simple string).
We also define a <code>PayrollOutputRecord</code> collection and some related methods (add an element, get the collection).</p>
</div>
<div class="paragraph">
<p>Make sure to resolve any missing imports. The class <code>PayrollDataHolderBean.java</code> should now compile and looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.batch.lab1</span>;

<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.Collections</span>;
<span class="keyword">import</span> <span class="include">java.util.HashSet</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.PostConstruct</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Startup</span>;

<span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollDataHolderBean</span> {
 <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; payrollInputRecords = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;PayrollOutputRecord&gt; payrollOutputRecords = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();

    <span class="directive">public</span> PayrollDataHolderBean() {

    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> onApplicationStartup() {
        <span class="keyword">for</span> (<span class="type">int</span> empID=<span class="integer">1</span>; empID&lt;<span class="integer">6</span>; empID++) {
            payrollInputRecords.add(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + empID + <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + (<span class="integer">80000</span> + empID*<span class="integer">10000</span>));
        }
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getPayrollInputData() {
        <span class="keyword">return</span> <span class="predefined-type">Collections</span>.unmodifiableList(payrollInputRecords);
    }

    <span class="directive">public</span> <span class="type">void</span> addPayrollOutputRecord(PayrollOutputRecord data) {
        payrollOutputRecords.add(data);
    }

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;PayrollOutputRecord&gt; getPayrollOutputRecords() {
        <span class="keyword">return</span> payrollOutputRecords;
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_payroll_job_the_reader_the_processor_the_writer">1.3. PayRoll Job : the Reader, the Processor, the Writer</h3>
<div class="paragraph">
<p>Now that we have everything set in place, we can tackle the main part of the exercise, i.e. create the batch job!</p>
</div>
<div class="paragraph">
<p>A batch job uses a simple <em>Read - Process - Write</em> pattern. A <strong>Reader</strong> is used to retrieve the input data, a <strong>Processor</strong> will then do some processing on those data and finally, a <strong>Writer</strong> will save the results somewhere. How the data are actually read (e.g. from a filesystem, from a database, from memory, etc.) is not specified so we are free to use, in a Reader, the mechanism we want. In our exercise, we will just read some data stored in an singleton EJB.</p>
</div>
<div class="paragraph">
<p>The same is true for the output, for the Writer. The specification doesn&#8217;t say how the output should be saved so we can use different approaches (e.g. send a mail, post to a JMS queue, update a Database via JPA or JBDC, etc.)</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The fundamental unit of a <strong>Job</strong> is a <strong>Step</strong>. A job is made of one or more steps. JSR 352 defines 2 types of steps: <strong>Chunk</strong> step used to work on data using the Read-Process-Write pattern and <strong>Batchlet</strong> step used to perform task(s) within a job (e.g. send via FTP the final result of a Job).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>A <strong>chunk-style step</strong> contains exactly one <strong>ItemReader</strong>, one <strong>ItemProcessor</strong>, and one <strong>ItemWriter</strong>. In this pattern, items are processed "chunk-size" at a time. The "chunk-size" is specified in the Job xml.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
JSR 352 also defines a XML based language called <strong>JSL</strong> (Job Specification Language). JSL is used to assemble together different steps to form a job, defines the flow between the different steps and also configure the behaviour of the Job itself (e.g. what to do in case of error).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>A chunk is processed as follows: The batch runtime starts a transaction and calls the ItemReader to read one item at a time. The batch runtime then passes this item to the ItemProcessor that processes the item based upon the business logic (such as "calculate net pay"), and returns the processed item to the batch runtime for aggregation. Once the "chunk-size" number of items are read and processed, they are given to an ItemWriter, which writes the data (for example, to a database table or a flat file). The transaction is then committed. The process repeats till the ItemReader finishes reading all items.</p>
</div>
<div class="paragraph">
<p>To implement a batch Job, we will have implement at least one Chunked step. Implementing a Chunked step means developing in Java : a Reader, a Processor and a Writer. That is exactly what will do in the next few sections, we will develop a Reader, a Writer and a Processor. We will then define the Job itself using JSL.</p>
</div>
<div class="sect3">
<h4 id="_reader">1.3.1. Reader</h4>
<div class="paragraph">
<p>A Reader is class that extends the abstract <code>javax.batch.api.chunk.AbstractItemReader</code> class defined in JSR 352.</p>
</div>
<div class="paragraph">
<p>Create, in the right package, a new class called PayrollInputRecordReader and in the class declaration, specify that this class should extends the <code>AbstractItemReader</code> class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.11.jpg" alt="E1.11">
</div>
<div class="title">Figure 10. extends the <code>AbstractItemReader</code> class</div>
</div>
<div class="paragraph">
<p>Make sure to fix the import for the <code>AbstractItemReader</code> class.
You can see that NetBeans is still unable to compile the code, this is because the class we are extending is abstract. To fix this, just make sure to implements all the abstract methods (one in this case, the <code>readItem()</code> method).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.12.jpg" alt="E1.12">
</div>
<div class="title">Figure 11. Using NetBeans to implements the abstract methods</div>
</div>
<div class="paragraph">
<p>The exercise data will be coming from the singleton EJB we have defined previously, so you can inject this EJB by adding the following declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@EJB</span>
    PayrollDataHolderBean payrollDataHolderBean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create the <code>payrollInputRecordsIterator</code> Iterator</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="predefined-type">Iterator</span>&lt;<span class="predefined-type">String</span>&gt; payrollInputRecordsIterator;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we should initialize it with the data contained in the EJB.  We will do this in the <code>open()</code> method defined in the <code>AbstractItemReader</code> class. As its name implies, this method is invoked by the Batch runtime to open ressources required by the Reader.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> e) <span class="directive">throws</span> <span class="exception">Exception</span> {
        payrollInputRecordsIterator = payrollDataHolderBean.getPayrollInputData().iterator();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will now rewrite the <code>readItem()</code> method as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = payrollInputRecordsIterator.hasNext() ? payrollInputRecordsIterator.next() : <span class="predefined-constant">null</span>;
        PayrollInputRecord record = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (line != <span class="predefined-constant">null</span>) {
            <span class="predefined-type">StringTokenizer</span> tokenizer = <span class="keyword">new</span> <span class="predefined-type">StringTokenizer</span>(line, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">String</span> empId = tokenizer.nextToken();
            <span class="predefined-type">String</span> salary = tokenizer.nextToken();
            <span class="keyword">if</span> (tokenizer.hasMoreTokens())
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Extra characters in input data: </span><span class="delimiter">&quot;</span></span> + line);
            record = <span class="keyword">new</span> PayrollInputRecord(<span class="predefined-type">Integer</span>.valueOf(empId));
            record.setSalary(salary);
        }

        <span class="keyword">return</span> record;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>readItem()</code> method is invoked by the Batch runtime, the method will then return the next item. If there is no more item, it will return <code>null</code> instead.
The code is fairly easy to understand, it iterates over all the employees and for each of them, it creates a <code>PayrollInputRecord</code> object with his/her details, object which is then returned by the <code>readItem()</code> method.</p>
</div>
<div class="paragraph">
<p>We can use the <code>open()</code> method to initialize any ressources that is required by the Reader. In our case, the initialization is limited to copy the <code>payrollDataHolderBean</code> data to the <code>payrollInputRecordsIterator</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> e) <span class="directive">throws</span> <span class="exception">Exception</span> {
        payrollInputRecordsIterator = payrollDataHolderBean.getPayrollInputData().iterator();
    }</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You should now know how to detect any missing import and how to solve this.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>We should also decorate the class with the <code>@Named</code> annotation.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
When running in Java EE environment, the Batch runtime uses CDI (Context and Dependency Injection) to instantiate Job artifacts (like Item{Reader, Writer, Procesor} etc.).  The <code>@Named</code> annotation allows us to access a bean by using its bean name (with the first letter in lowercase). So annotating the ItemReader with <code>@Named</code> will allow us to reference the Reader in our Job XML just by using its bean name.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Once you have resolved the missing imports, your <code>PayrollInputRecordReader.java</code> class should look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.batch.lab1</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.Iterator</span>;
<span class="keyword">import</span> <span class="include">java.util.StringTokenizer</span>;
<span class="keyword">import</span> <span class="include">javax.batch.api.chunk.AbstractItemReader</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.EJB</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollInputRecordReader</span> <span class="directive">extends</span> AbstractItemReader {

    <span class="annotation">@EJB</span>
    PayrollDataHolderBean payrollDataHolderBean;

    <span class="predefined-type">Iterator</span>&lt;<span class="predefined-type">String</span>&gt; payrollInputRecordsIterator;

    <span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = payrollInputRecordsIterator.hasNext() ? payrollInputRecordsIterator.next() : <span class="predefined-constant">null</span>;
        PayrollInputRecord record = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (line != <span class="predefined-constant">null</span>) {
            <span class="predefined-type">StringTokenizer</span> tokenizer = <span class="keyword">new</span> <span class="predefined-type">StringTokenizer</span>(line, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">String</span> empId = tokenizer.nextToken();
            <span class="predefined-type">String</span> salary = tokenizer.nextToken();
            <span class="keyword">if</span> (tokenizer.hasMoreTokens())
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Extra characters in input data: </span><span class="delimiter">&quot;</span></span> + line);
            record = <span class="keyword">new</span> PayrollInputRecord(<span class="predefined-type">Integer</span>.valueOf(empId));
            record.setSalary(salary);
        }

        <span class="keyword">return</span> record;
    }

    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> e) <span class="directive">throws</span> <span class="exception">Exception</span> {
        payrollInputRecordsIterator = payrollDataHolderBean.getPayrollInputData().iterator();
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processor">1.3.2. Processor</h4>
<div class="paragraph">
<p>As its name implies, a Processor will handle, within a batch step, the actual data processing, data that is provided by the Reader. Technically, a Processor is a class that implements the <code>javax.batch.api.chunk.ItemProcessor</code> interface defined in the JSR 352 specification and has a <code>processItem()</code> method. The argument to this method is the item that was read by the ItemReader. The method must return a processed item. The processed item need not be the same type as the item read by the ItemReader.</p>
</div>
<div class="paragraph">
<p>So, create a new class called <code>NetPayProcessor</code> and specify that it implements the  <code>ItemProcessor</code> interface. Decorate the class with the <code>@Named</code> annotation, resolve the missing imports and ask NetBeans to implement the abstract method.</p>
</div>
<div class="paragraph">
<p>We should now change the <code>processItem()</code> method to perform the actual data processing, so change this method as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> obj) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PayrollInputRecord inputRecord = (PayrollInputRecord) obj;
        <span class="type">float</span> salary = <span class="predefined-type">Integer</span>.valueOf(inputRecord.getSalary());
        <span class="type">float</span> socialSecurityTax =
                salary &gt; <span class="integer">117000</span> ? <span class="integer">117000</span> * <span class="float">6.2f</span> / <span class="integer">100</span> : salary * <span class="float">6.2f</span> / <span class="integer">100</span>;

        PayrollOutputRecord outputRecord = <span class="keyword">new</span> PayrollOutputRecord(inputRecord.getId());
        outputRecord.setSalary(salary / <span class="float">24.0f</span>);
        outputRecord.setSocialSecurityTax(socialSecurityTax / <span class="float">24.0f</span>);
        outputRecord.setNet(outputRecord.getSalary() - outputRecord.getSocialSecurityTax());

        <span class="keyword">return</span> outputRecord;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method casts the received object to a <code>PayrollInputRecord</code>. It does some computations and then creates and initializes a <code>PayrollOutputRecord</code> object, compute and set a net salary. That <code>PayrollOutputRecord</code> object is then returned to the calling method.</p>
</div>
<div class="paragraph">
<p>Your <code>NetPayProcessor.java</code> class should now look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.javaee7.batch.lab1</span>;

<span class="keyword">import</span> <span class="include">javax.batch.api.chunk.ItemProcessor</span>;
<span class="keyword">import</span> <span class="include">javax.batch.runtime.context.JobContext</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NetPayProcessor</span>
    <span class="directive">implements</span> ItemProcessor {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobContext;

    <span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> obj) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PayrollInputRecord inputRecord = (PayrollInputRecord) obj;
        <span class="type">float</span> salary = <span class="predefined-type">Integer</span>.valueOf(inputRecord.getSalary());
        <span class="type">float</span> socialSecurityTax =
                salary &gt; <span class="integer">117000</span> ? <span class="integer">117000</span> * <span class="float">6.2f</span> / <span class="integer">100</span> : salary * <span class="float">6.2f</span> / <span class="integer">100</span>;

        PayrollOutputRecord outputRecord = <span class="keyword">new</span> PayrollOutputRecord(inputRecord.getId());
        outputRecord.setSalary(salary / <span class="float">24.0f</span>);
        outputRecord.setSocialSecurityTax(socialSecurityTax / <span class="float">24.0f</span>);
        outputRecord.setNet(outputRecord.getSalary() - outputRecord.getSocialSecurityTax());

        <span class="keyword">return</span> outputRecord;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writer">1.3.3. Writer</h4>
<div class="paragraph">
<p>After the Reader and the Processor, we now need to develop the Writer to save our results. A Writer is a class that extends the <code>javax.batch.api.chunk.AbstractItemWriter</code> interface and implements the <code>writeItems()</code> method. Do note that the ItemWriter is given a list of items processed by the ItemWriter.</p>
</div>
<div class="paragraph">
<p>As usual, create a class named <code>PayrollOutputRecordWriter</code> in the right package. Resolve the import and ask NetBeans to implement the abstract method.</p>
</div>
<div class="paragraph">
<p>Remember that for the sake of simplicity, we will save the results in the Bean we have created earlier, so you need to inject that bean with the following code.</p>
</div>
<div class="paragraph">
<p>We should also decorate the class with the <code>@Named</code> annotation and resolve the missing import.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@EJB</span>
    <span class="directive">private</span> PayrollDataHolderBean bean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we will change the <code>writeItems()</code> method to save the results, that is, to add the results to our bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span> list) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">for</span> (<span class="predefined-type">Object</span> obj : list) {
            bean.addPayrollOutputRecord((PayrollOutputRecord) obj);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your <code>PayrollOutputRecordWriter.java</code> class should now look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.batch.lab1</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">javax.batch.api.chunk.AbstractItemWriter</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.EJB</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollOutputRecordWriter</span> <span class="directive">extends</span> AbstractItemWriter {
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> PayrollDataHolderBean bean;

    <span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span> list) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">for</span> (<span class="predefined-type">Object</span> obj : list) {
            bean.addPayrollOutputRecord((PayrollOutputRecord) obj);
        }
   }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_all_the_pieces_together_jsl">1.4. Putting all the pieces together : JSL</h3>
<div class="paragraph">
<p>In the previous section, we have defined a Chunk step with a Reader, a Processor and a Writer. Now, we need to wire together those elements to actually form a Job that will be executable by the JSR 352 runtime. For that, we will use a XML based language defined  by the JSR 352 specification : the <strong>Job Specification Language (JSL)</strong>.</p>
</div>
<div class="paragraph">
<p>Go to Files tab (usually, it is next to the Project tab). Expand your project "WEB-INF" directory ("web/WEB-INF") and with the NetBeans wizard (New "Folder" in the "Other" Category) create the following directory hierarchy : "classes/META-INF/batch-jobs"</p>
</div>
<div class="paragraph">
<p>In the "batch-jobs" directory, create a XML file named <code>PayrollJob.xml</code> (New "XML Document" from the "XML" category).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.14.jpg" alt="E1.14">
</div>
<div class="title">Figure 12. Create the JSL file</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
This XML file will be the JSL that will describe our Job. It will be needed to control the Batch itself in the next step so make sure to note its name.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Edit the <code>PayrollJob.xml</code> as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
            <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">netPayProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
            <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollOutputRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are defining a Job called "PayrollJob" made of a single chunk step called "process".
We then define the Reader, the Processor and the Writer of the "process" step. Execution of the job commences by executing the first step listed in the Job XML. Our first step is a chunk style step with "chunk size" (item-count) of 3. The step also lists an ItemReader identified by the CDI bean name <code>payRollInputRecordReader</code>. Similarly, the step lists an ItemProcessor and a ItemWriter by the beans names <code>netPayProcessor</code> and <code>payRollOutputRecordWriter</code> respectively. In order to execute the step, the Batch runtime uses CDI to instantiate the specified ItemReader, ItemProcessor and ItemWriter. It then calls the ItemReader&#8217;s <code>readItem()</code> and ItemProcessor&#8217;s <code>processItem()</code> "item-count" times (3 in our sample). These processed items are then collected and passed to the ItemWriter&#8217;s <code>writeItems()</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_executing_the_job">1.5. Executing the Job</h3>
<div class="paragraph">
<p>In the previous section, we have defined the implementations of our Step (Reader, Processor and Writer). Using JSL, we have then referenced those implementations to define the batch job. The last thing we need to do is to submit the job for execution.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
JSR 352 defines the <code>javax.batch.operations.JobOperator</code> interface to control jobs. Via this interface, it is possible to start, stop, and restart jobs. It is also possible to inspect job history, to discover what jobs are currently running, what jobs have previously run, etc. For more details, check the <a href="http://docs.oracle.com/javaee/7/api/javax/batch/operations/JobOperator.html">javadoc</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_the_job_for_execution">1.5.1. Submitting the job for execution</h4>
<div class="paragraph">
<p>Edit the the <code>BatchJobSubmitter.java</code> servlet we have defined earlier, insert the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">private</span> <span class="type">long</span> submitJobFromXML(<span class="predefined-type">String</span> jobName) <span class="directive">throws</span> <span class="exception">Exception</span> {
        JobOperator jobOperator = BatchRuntime.getJobOperator();
        <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        <span class="keyword">return</span> jobOperator.start(jobName, props);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method gets a <code>jobOperator</code> instance using the <code>BatchRuntime.getJobOperator()</code> method. It then invokes the <code>jobOperator.start()</code> method to start the job. The first parameter passed to the <code>jobOperator.start()</code> method is the job xml name. This xml must reside under the "WEB-INF/classes/META-INF/batch-jobs" directory.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Putting the JSL in a wrong directory or using a different name are frequent errors when starting with JSR 352.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_job_details">1.5.2. Get the job details</h4>
<div class="paragraph">
<p>We will again leverage the <code>jobOperator</code> interface to get runtime details of job. We will write a few utility methods to gather data and display the results. First, add the following method to the servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="directive">private</span> <span class="type">void</span> displayJobDetails(<span class="predefined-type">PrintWriter</span> pw, <span class="type">long</span> executionId) {
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;&lt;td&gt;Status of Submitted Jobs&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table border=</span><span class="char">\&quot;</span><span class="content">yes</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;&lt;td&gt;Job Name&lt;/td&gt;&lt;td&gt;Instance Id&lt;/td&gt;&lt;td&gt;ExecutionID&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
          + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;Batch Status&lt;/td&gt;&lt;td&gt;Exit Status&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
          + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;Start Time Status&lt;/td&gt;&lt;td&gt;End Time&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
          + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);

      JobOperator jobOperator = BatchRuntime.getJobOperator();
        <span class="keyword">try</span> {
            <span class="keyword">for</span> (JobInstance jobInstance : jobOperator.getJobInstances(<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="predefined-type">Integer</span>.MAX_VALUE-<span class="integer">1</span>)) {
                <span class="keyword">for</span> (JobExecution jobExecution : jobOperator.getJobExecutions(jobInstance)) {
                   <span class="predefined-type">StringBuilder</span> sb = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
                    <span class="keyword">if</span> (executionId == jobExecution.getExecutionId()) {
                        sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr style=</span><span class="char">\&quot;</span><span class="content">background-color: green;</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>);
                    } <span class="keyword">else</span> {
                        sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;</span><span class="delimiter">&quot;</span></span>);
                    }
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getJobName()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobInstance.getInstanceId()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getExecutionId()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getBatchStatus()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getExitStatus()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getStartTime()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
                    sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span>).append(jobExecution.getEndTime()).append(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
                    pw.println(sb.toString());
                }
            }
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
            pw.println(ex.toString());
        }
        pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/table&gt;</span><span class="delimiter">&quot;</span></span>);
        pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/table&gt;</span><span class="delimiter">&quot;</span></span>);
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <code>BatchRuntime.getJobOperator()</code> method to get a <code>JobOperator</code> instance.
We then invoke the <code>getJobInstances()</code> method on this <code>JobOperator</code> instance to get the different job instances.
And for all the job instances, we pass each instances to the <code>jobOperator.getJobExecutions()</code> method and get in return a <code>JobExecution</code> object. Once we have that object, we can query the different values we need (e.g. start time, etc.).
The rest (and bulk) of this method generate HTML.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
Hard coding HTML directly in a servlet is not recommended for any serious application.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also add the following method to display the input data used by the job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="directive">private</span> <span class="type">void</span> displayPayrollForm(<span class="predefined-type">PrintWriter</span> pw)
        <span class="directive">throws</span> <span class="exception">Exception</span> {

        pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table border = </span><span class="char">\&quot;</span><span class="content">yes</span><span class="char">\&quot;</span><span class="content">&gt;&lt;tr&gt;&lt;td&gt;Payroll Input Records (Comma Separated Values)&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="predefined-type">String</span> line : payrollDataHolderBean.getPayrollInputData()) {
                pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;&lt;td&gt;</span><span class="delimiter">&quot;</span></span> + line + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
        }
        pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/table&gt;</span><span class="delimiter">&quot;</span></span>);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>NetBeans will complain about <code>payrollDataHolderBean</code> bean that is supposed to hold the data, so you should inject it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@EJB</span>
    PayrollDataHolderBean payrollDataHolderBean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now add the <code>displayProcessedPayrollRecords()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="directive">private</span> <span class="type">void</span> displayProcessedPayrollRecords(<span class="predefined-type">PrintWriter</span> pw, <span class="type">long</span> executionId) <span class="directive">throws</span> <span class="exception">Exception</span> {
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;form&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Processed Payroll Records</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table border = </span><span class="char">\&quot;</span><span class="content">yes</span><span class="char">\&quot;</span><span class="content">&gt;&lt;tr&gt;&lt;td&gt;Employee ID&lt;/td&gt;&lt;td&gt;Salary&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
          + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;Social Security&lt;/td&gt;&lt;td&gt;Net&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">for</span> (PayrollOutputRecord record : payrollDataHolderBean.getPayrollOutputRecords()) {
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;&lt;td&gt;</span><span class="delimiter">&quot;</span></span> + record.getEmpId()+ <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span> + record.getSalary() + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span> + record.getSocialSecurityTax()+ <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;</span><span class="delimiter">&quot;</span></span> + record.getNet()+ <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
      }
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;&lt;input type=</span><span class="char">\&quot;</span><span class="content">hidden</span><span class="char">\&quot;</span><span class="content"> name=</span><span class="char">\&quot;</span><span class="content">executionId</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + executionId + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;&lt;input type=</span><span class="char">\&quot;</span><span class="content">submit</span><span class="char">\&quot;</span><span class="content"> name=</span><span class="char">\&quot;</span><span class="content">calculatePayroll</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="content">Calculate Payroll</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/td&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;td&gt;&lt;input type=</span><span class="char">\&quot;</span><span class="content">submit</span><span class="char">\&quot;</span><span class="content"> name=</span><span class="char">\&quot;</span><span class="content">refresh</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="content">refresh</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/table&gt;</span><span class="delimiter">&quot;</span></span>);
      pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/form&gt;</span><span class="delimiter">&quot;</span></span>);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method displays, in a HTML form, a table containing the job results using the <code>payrollDataHolderBean</code> bean. Towards the end, you can also see that the method print raw HTML with the 2 buttons that the end user will use to control the application (e.g. "Calculate Payroll" &amp; "Refresh").</p>
</div>
<div class="paragraph">
<p>Finally, we will rewrite the existing <code>processRequest()</code> servlet method to use those utilities methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request, HttpServletResponse response)
         <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
      response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">try</span> (<span class="predefined-type">PrintWriter</span> pw = response.getWriter()) {
          pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;</span><span class="delimiter">&quot;</span></span>);
          pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;title&gt;Servlet BatchJobSubmitter&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</span><span class="delimiter">&quot;</span></span>);

          <span class="type">long</span> executionId = -<span class="integer">1</span>;
          <span class="keyword">if</span> (request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">executionId</span><span class="delimiter">&quot;</span></span>) != <span class="predefined-constant">null</span>) {
              executionId = <span class="predefined-type">Long</span>.valueOf(request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">executionId</span><span class="delimiter">&quot;</span></span>));
          }

          <span class="keyword">try</span> {
             <span class="keyword">if</span> (request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">calculatePayroll</span><span class="delimiter">&quot;</span></span>) != <span class="predefined-constant">null</span>) {
                 executionId = submitJobFromXML(<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span>);
             }
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table&gt;</span><span class="delimiter">&quot;</span></span>);
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tr&gt;&lt;td&gt;</span><span class="delimiter">&quot;</span></span>);
             displayPayrollForm(pw);
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;&lt;td&gt;</span><span class="delimiter">&quot;</span></span>);
             displayProcessedPayrollRecords(pw, executionId);
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">&quot;</span></span>);
             pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/table&gt;</span><span class="delimiter">&quot;</span></span>);
             displayJobDetails(pw, executionId);
         } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
             <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(ex);
         }
         pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span>);
         pw.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
      }
   }</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure the string parameter you pass to the <code>submitJobFromXML()</code> method corresponds to the name of the JSL file describing your Job (without the .xml extension)!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, we are working with Explicit CDI Beans Archive so we need to create a bean.xml. For a Web Application, this beans.xml has to be in the WEB-INF directory so right click on the WEB-INF directory and create an empty file called "beans.xml".</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The CDI container is looking for a "beans.xml" file in the WEB-INF directory. If it&#8217;s not there or present under a different name, the application will not work as it rely on some CDI features.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_payroll_application">1.6. Testing the Payroll application</h3>
<div class="paragraph">
<p>To test the application, right click on the <code>BatchJobSubmitter.java</code> servlet in the "Project" tab and select "Run". This action will compile and deploy the application and invoke your local browser with the Servlet URL. The first time, you should will see the following screen.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.15.jpg" alt="E1.15">
</div>
<div class="title">Figure 13. Initial screen : no job submitted yet</div>
</div>
<div class="paragraph">
<p>Now click on the "Calculate Payroll" button to submit a job for execution to the batch runtime. You can see that a job has been started but not yet completed (e.g. it has no end time). You can also see that the right column is empty at this stage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.16.jpg" alt="E1.16">
</div>
<div class="title">Figure 14. A job has been started</div>
</div>
<div class="paragraph">
<p>Finally, if you click on "refresh" the job will have had enough time to run completely. The results are displayed in the right column. You can also notice the end time of the job execution.
Since the data set is minimal and the processing trivial, the batch execution is almost instantaneous.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E1.17.jpg" alt="E1.17">
</div>
<div class="title">Figure 15. The job is now completed</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary">1.7. Summary</h3>
<div class="paragraph">
<p>In this Lab, we have learnt the core components of the batch processing architecture.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A job encapsulates the entire batch process. A job contains one or more steps. A job is put together using a <strong>Job Specification Language</strong> (JSL) that specifies the sequence in which the steps must be executed. In JSR 352, JSL is specified in an XML file called the job XML file. In short, <strong>a job (with JSR 352) is basically a container for steps</strong>.</p>
</li>
<li>
<p>A <strong>step</strong> is a domain object that encapsulates an <strong>independent, sequential phase of the job</strong>. A step contains all the necessary logic and data to perform the actual processing. The batch specification deliberately leaves the definition of a step vague because the content of a step is purely application-specific and can be as complex or simple as the developer desires. There are <strong>two kinds of steps: chunk and batchlet</strong>.</p>
</li>
<li>
<p>A <strong>chunk-style</strong> step contains exactly one <strong>ItemReader</strong>, <strong>one ItemProcessor</strong>, and <strong>one ItemWriter</strong>. In this pattern, ItemReader reads one item at a time, ItemProcessor processes the item based upon the business logic (such as "calculate account balance"), and hands it to the batch runtime for aggregation. Once the "chunk-size" number of items are read and processed, they are given to an ItemWriter, which writes the data (for example, to a database table or a flat file). The transaction is then committed.</p>
</li>
<li>
<p>JSR 352 also defines a roll-your-own kind of a step called a <strong>batchlet</strong>. A batchlet is free to use anything to accomplish the step, such as sending an e-mail. Batchlet will be discussed in the next section.</p>
</li>
<li>
<p><strong>JobOperator</strong> provides an interface to manage all aspects of job processing, including operational commands, such as start, restart, and stop, as well as job repository commands, such as retrieval of job and step executions. See section 10.4 of the JSR 352 specification for more details about JobOperator.</p>
</li>
<li>
<p><strong>JobRepository</strong> holds information about jobs currently running and jobs that ran in the past. JobOperator provides APIs to access this repository. A JobRepository could be implemented using, say, a database or a file system.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_batchlet_and_multi_steps_job">2. Lab: Batchlet and Multi-steps Job</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the first exercise, we have developed a simple job made of a single step, a Chunk step. This exercise will introduce you to <strong>Batchlet</strong>, the second type of step supported by JSR 352. Chunk step are used to work on data while Batchlets are useful for performing a variety of tasks that are not item-oriented, such as executing a command or performing a task (like copying files, preparing reports etc.).</p>
</div>
<div class="paragraph">
<p>To illustrate this, we will define a multi-steps job that combine 2 steps: a Chunk step and a Batchlet step.</p>
</div>
<div class="sect2">
<h3 id="_set_the_stage_2">2.1. Set the stage</h3>
<div class="paragraph">
<p>Open the "lab2" project in NetBeans ("File" , "Open Project" and select the "lab2" directory). If you run the project and access the "BatchJobSubmitter" servlet, you will see that it is very similar to  what we have done in the previous exercise.</p>
</div>
<div class="paragraph">
<p>It is a simple batch job made of a single Chunk step, the "prepare" step (check the JSL file describing the batch job).</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_the_batchlet_step">2.2. Implement the Batchlet step</h3>
<div class="paragraph">
<p>A Batchlet is a class that extends and implements the <code>javax.batch.api.AbstractBatchlet</code> interface. So create, in the source package, a new Java class called "SummaryProcessor" that extends the <code>AbstractBatchlet</code> interface. Use NetBeans to resolve the missing import and implement the abstract <code>process()</code> method.</p>
</div>
<div class="paragraph">
<p>Decorate the class with the <code>@Named</code> annotation and inject the <code>PayrollDataHolderBean</code> bean as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@EJB</span>
    PayrollDataHolderBean payrollDataHolderBean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>process()</code> method is doing the work of the Batchlet is supposed to do so let&#8217;s re-write it as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">  <span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
     SummaryRecord summaryRecord = <span class="keyword">new</span> SummaryRecord();

     <span class="keyword">try</span> {
         <span class="keyword">for</span> (PayrollOutputRecord outputRecord : payrollDataHolderBean.getPayrollOutputRecords()) {
            summaryRecord.addBonus(outputRecord.getBonus());
            summaryRecord.addNet(outputRecord.getNet());
            summaryRecord.addSalary(outputRecord.getSalary());
            summaryRecord.addSocialSecurityTax(outputRecord.getSocialSecurityTax());
         }
     } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
         <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>;
     }

     payrollDataHolderBean.setSummaryRecord(summaryRecord);
     <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Batchlet computes the total net, total salary and total socialsecurity of all the payroll records processed by first step. Once the imports have been fixed, the final <code>SummaryProcessor</code> Batchlet should looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.javaee7.batch.lab2</span>;
<span class="comment">// imports omitted !</span>

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SummaryProcessor</span> <span class="directive">extends</span> AbstractBatchlet {

    <span class="annotation">@EJB</span>
    PayrollDataHolderBean payrollDataHolderBean;

    <span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
       SummaryRecord summaryRecord = <span class="keyword">new</span> SummaryRecord();

       <span class="keyword">try</span> {
           <span class="keyword">for</span> (PayrollOutputRecord outputRecord : payrollDataHolderBean.getPayrollOutputRecords()) {
              summaryRecord.addBonus(outputRecord.getBonus());
              summaryRecord.addNet(outputRecord.getNet());
              summaryRecord.addSalary(outputRecord.getSalary());
              summaryRecord.addSocialSecurityTax(outputRecord.getSocialSecurityTax());
           }
       } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
           <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>;
       }

       payrollDataHolderBean.setSummaryRecord(summaryRecord);
       <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The return type of the <code>process()</code> method of a batchlet is the exit status of the Batchlet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_jsl">2.3. Update the JSL</h3>
<div class="paragraph">
<p>We now need to update the JSL file to make sure the Batchlet is part of the job. Open "PayRollJob.xml" (in "web/WEB-INF/classes/META-INF/batch-jobs") and add the Batch "summary" step to the job as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

     <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prepare</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
            <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">netPayProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
            <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollOutputRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/step&gt;</span>

    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">summaryProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, the execution commences by executing the first step listed in the job xml. If the step completes normally, then the step specified in the "next" attrinute will be executed.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware that if you don&#8217;t specify the next attribute, the execution stops after the first step!
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_payroll_application_2">2.4. Testing the Payroll application</h3>
<div class="paragraph">
<p>If you run the job again, you should now see an additional "TOTAL" line in the right table. Those data are computed in in the Batchlet and displayed by the <code>displayProcessedPayrollRecords()</code> method when <code>summaryRecord</code> is not null.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E2.3.jpg" alt="E2.3">
</div>
<div class="title">Figure 16. Total values computed by the Batchlet step</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_2">2.5. Summary</h3>
<div class="paragraph">
<p>In this Lab, we learnt</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how to write a Batchlet step</p>
</li>
<li>
<p>how to combine multiple steps within a single Job</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_checkpoints_and_the_joboperator_interface">3. Lab: Checkpoints and the JobOperator interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is focusing on two additional JSR 352 aspects: checkpoint and the JobOperator interface.</p>
</div>
<div class="paragraph">
<p><strong>JobOperator</strong> provides an interface to manage all aspects of job processing, including operational commands, such as start, restart, and stop, as well as job repository commands. We have already used it in previous exercises to start jobs and also to get their execution status. In this exercise, we will see how we can resume the execution of a failed job.</p>
</div>
<div class="paragraph">
<p>To avoid having to restart a failed job from the beginning, JSR 352 support the concept of checkpoint. A <strong>checkpoint</strong> allows a step to periodically bookmark its current progress to enable restart from the last point of consistency should this job be stopped (intentionally or unintentionally).</p>
</div>
<div class="sect2">
<h3 id="_set_the_stage_3">3.1. Set the stage</h3>
<div class="paragraph">
<p>Open and run the "Lab 3" project. This PayRoll application is again very similar. It has a single Chunk step. The only real difference is that this application let you update, delete and add Input Records. We will use this feature to intentionally introduce corrupt data to force our job to fail. We will finally use the JobOperator interface to resume the job execution where it has failed.</p>
</div>
<div class="paragraph">
<p>The GlassFish console is a useful tool to understand what is going on. Go in the "Services" tab and locate the GlassFish instance (it&#8217;s probably called "GlassFish 4.1" or "GlassFish Server"). Right click on it and select "View Domain Server Log", this action will open the GlassFish Logs in the NetBeans "Output" window.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E2.2.jpg" alt="E2.2">
</div>
<div class="title">Figure 17. GlassFish Server Log</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_a_job">3.2. Start a job</h3>
<div class="paragraph">
<p>Locate the <code>displayPayrollForm()</code> method in the <code>BatchJobSubmitter</code> servlet. This method uses a <code>switch</code> to handle the different commands: start a job to calculate a payroll, add, update and delete input records.</p>
</div>
<div class="paragraph">
<p>If you look at the <code>submitJobFromXML()</code> method that is invoked via the "calculatePayroll" command, you will notice that starting a job is easy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">  JobOperator jobOperator = BatchRuntime.getJobOperator(); <span class="comment">// get a jobOperator instance</span>
  <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>(); <span class="comment">// set some properties</span>
  id = jobOperator.start(jobName, props); <span class="comment">// and start to job</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>jobOperator</code> instance is used to interact with the batch runtime. Once you have that instance, all you have to do is to invoke its <code>start()</code> method and pass it the jobNanme and eventually some properties (see  <a href="http://docs.oracle.com/javaee/7/api/javax/batch/operations/JobOperator.html#start">javadoc</a>). Note that the jobName parameter is the actual name of the JSL file describing the job (without the XML extension). The <em>start()</em> method will return an execution ID that we can use to continue to interact with the job via the batch runtime (e.g. stop the job, query the status of the job, etc.).</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The location of the job xml is spec defined. It must be defined under "WEB-INF/classes/META-INF/batch-jobs" (for war files) or under "META-INF/batch-jobs" (for ejb jar files).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_break_the_job">3.3. Break the job!</h3>
<div class="paragraph">
<p>We will now introduce some corrupt data to force our job to fail. For example, you can update the 5th record by replacing the "," with a space and click "update". You can now start the job and "if everything goes well", your job will fail with an "Exit status: FAILED". A "restart" button should also appear on the right side of the last failed job.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E3.1.jpg" alt="E3.1">
</div>
<div class="title">Figure 18. Break the job</div>
</div>
<div class="paragraph">
<p>In the log, we can see that the Job fails at the fifth record and that there is a checkpoint every <strong>2</strong> records. This is defined in the Chunk step element in the JSL file.
The "item-count" attribue (the size) of the "chunk" element specify the number of items to process per chunk (10 per default). At the end, a checkpoint will be performed since this is an obvious place for such action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>...
...[INFO]...[ ** Calculating net pay for empId: 1 ]
...[INFO]...[ ** Calculating net pay for empId: 2 ]
...[INFO]...[ PayrollInputRecordReader: Checkpointing reader position: 2 ]
...[INFO]...[ ** Calculating net pay for empId: 3 ]
...[INFO]...[ ** Calculating net pay for empId: 4 ]
...[INFO]...[ PayrollInputRecordReader: Checkpointing reader position: 4 ]
...[SEVERE]...[[ Failure in Read-Process-Write Loop com.ibm.jbatch.container.exception.BatchContainerRuntimeException: java.util.NoSuchElementException]]
...</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E3.2.jpg" alt="E3.2">
</div>
<div class="title">Figure 19. Defining the size of the chunk step</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Any real application would obviously implement more severe validation strategies. We haven&#8217;t because it&#8217;s not the purpose of this exercise and we are also using that weaknesses to demonstrate some of the JSR5352 features.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resume_a_failed_job">3.4. Resume a failed job</h3>
<div class="paragraph">
<p>We will now update the  <code>displayPayrollForm()</code> method to also handle the "restart" command. In <code>switch' construction, add an extra `case</code> with the following logic to handle the "restart" command with the following logic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">restart</span><span class="delimiter">&quot;</span></span>:
      executionId = restartJob(executionId);
      session.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">executionId</span><span class="delimiter">&quot;</span></span>, executionId);
      <span class="keyword">break</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restarting a failed job is also done via the jobOperator interface and more particularly via its <code>restart()</code> method. We pass, to this method, the execution ID of the failed job and we get in return a new execution ID.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
JSR 352 allows only the most recent execution id to the restart method. Thats why our application attaches the restart button to the most recent job!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If you fix and update the wrong input record and "restart" the job, the job should now exit with a "COMPLETED" status.</p>
</div>
<div class="paragraph">
<p>If you check the GlassFish log, you will notice that job is restarted from the last known checkpint (i.e. 4) so it read and process the next item (5 in this case). A final checkpoint is performed after the last record.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>...[INFO]...[ PayrollInputRecordReader: resuming from: 4 ]
...[INFO]...[ ** Calculating net pay for empId: 5 ]
...[INFO]...[ PayrollInputRecordReader: Checkpointing reader position: 5 ]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_3">3.5. Summary</h3>
<div class="paragraph">
<p>Job restarts (resumption of jobs rather) is possible due to the checkpointing mechanism. Execution of a check style step commences by the batch runtime calling the ItemReader&#8217;s <code>open()</code> method. If the step is not due to a re-start (meaning a the job is being executed using <code>jobOperator.start()</code>) then a <code>null</code> value is passed to the <code>open()</code> method (else the previous checkpointed data is passed).
Once every "item-count" (chunk size) number of items have been written out by the ItemWriter, the Batch runtime calls the <code>checkpointInfo()</code> method on the ItemReader. The item reader can return any Serializable data that captures its current state (like number of items read etc.). This Serializable data will be saved by the batch runtime in the JobRepository and allows the batch runtime to track the last known checkpointed state.
If the job were to fail now (or before the next checkpoint), the Job can be resumed by calling the <code>JobOperator.restart()</code> method. Job restart processing begins by the batch runtime calling the ItemReader&#8217;s <code>open()</code> method with the previous run&#8217;s checkpointed data. This allows the ItemReader to resume reading from the previous successful point and thus allows the Job to resume rather than start from the beginning.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_listeners">4. Lab: Listeners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the first exercise, we have created the simple batch application from scratch.
This exercise will build on that initial application and will introduce listeners.
<strong>Listeners</strong> are used to intervene, at the different levels, during the life-cylcle of a batch job.</p>
</div>
<div class="paragraph">
<p>A listener is configured to receive the execution control at some well defined phases during the execution of the job.
They can be configured at different level (step level before or after, job level, &#8230;)
Technically, a listener is a class that that implements one of the listener interfaces defined in the JSR 352 specification.</p>
</div>
<div class="sect2">
<h3 id="_set_the_stage_4">4.1. Set the stage</h3>
<div class="paragraph">
<p>We will now start from a NetBeans project that already contains a simple batch application. So just open the "Lab4" project in NetBeans.
As you explore the project files, you will notice the servlet that is used to control the batch, the reader, the processor and the writer, the JSL that defines the job, etc.
In short, this application does almost what we developed in the first exercise.
The only real difference is that it is now possible to add Payroll input records in the UI and restart the last executed job. Run the job and check the result in the GlassFish console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>... PayrollInputRecordReader: resuming from: 0
... ** Calculating net pay for empId: 1
... ** Calculating net pay for empId: 2
... ** Calculating net pay for empId: 3
... PayrollInputRecordReader: Checkpointing reader position: 3
... ** Calculating net pay for empId: 4
... ** Calculating net pay for empId: 5
... PayrollInputRecordReader: Checkpointing reader position: 5</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_listener_at_the_job_level">4.2. Defining a listener at the Job level</h3>
<div class="paragraph">
<p>Let&#8217;s define a listener at the job level.
For that, you should create a class called "PayrollJobListener" that implements the <code>javax.batch.api.listener.JobListener</code> interface.
Make sure to decorate the class with the <code>@Named</code> annotation.
NetBeans will help you to resolve the missing import and implement the abstract methods : <code>beforeJob()</code> and <code>afterJob()</code>.</p>
</div>
<div class="paragraph">
<p>To use, in the listener, information related to the job instance, we need to inject the job context object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@Inject</span>
   JobContext jobContext;</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Since this is a Job level listener, there is no Step context.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Rewrite the 2 methods as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeJob() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">** PayrollJobListener:: Job started at: </span><span class="delimiter">&quot;</span></span> + (<span class="keyword">new</span> <span class="predefined-type">Date</span>()));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterJob() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">** PayrollJobListener:: Job completed at: </span><span class="delimiter">&quot;</span></span> + (<span class="keyword">new</span> <span class="predefined-type">Date</span>())
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">; exitStatus : </span><span class="delimiter">&quot;</span></span> + jobContext.getExitStatus() + <span class="string"><span class="delimiter">&quot;</span><span class="content">; </span><span class="delimiter">&quot;</span></span> + jobContext.getBatchStatus());
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last thing we need to do is to update the JSL to include this listener ans since it is a Job level listener, we should make sure to define it at the job level!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollJobListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/listeners&gt;</span>
        ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we run the batch once again, we can observer in the console that the job level listener has been invoked at the beginning (<code>beforeJob()</code> method) and at the end (<code>afterJob()</code> method).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>Info:   ** PayrollJobListener:: Job started at: Tue Aug 12
Info:   ** PayrollStepListener:: Step started at: Tue Aug 12; stepContext: STARTED
Info:   PayrollInputRecordReader: resuming from: 0
Info:   ** Calculating net pay for empId: 1
Info:   ** Calculating net pay for empId: 2
Info:   ** Calculating net pay for empId: 3
Info:   PayrollInputRecordReader: Checkpointing reader position: 3
Info:   ** Calculating net pay for empId: 4
Info:   ** Calculating net pay for empId: 5
Info:   PayrollInputRecordReader: Checkpointing reader position: 5
Info:   ** PayrollStepListener:: Step ended at: Tue Aug 12; stepContext: STARTED
Info:   ** PayrollJobListener:: Job completed at: Tue Aug 12; exitStatus : null; STARTED</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_listener_s_at_the_step_level">4.3. Defining listener(s) at the Step level</h3>
<div class="paragraph">
<p>Setting listeners at the level of the job might be, in some cases, too coarse grained.
Luckily, JSR 352 allows us to define listeners at the step level.</p>
</div>
<div class="paragraph">
<p>In the project source directory, create a new java class called "PayrollStepListener".
This class needs to implement the <code>javax.batch.api.listener.StepListener</code> interface.
Use NetBeans to resolve the import and implements the abstract methods.</p>
</div>
<div class="paragraph">
<p>You should now have 2 methods : <code>beforeStep()</code> and <code>afterStep()</code></p>
</div>
<div class="paragraph">
<p>In the previous listener, we used the Job context but this time, we have also the step context at our disposal.
You can inject the step context in your listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@Inject</span>
   StepContext stepContext;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will use this context to gather some information.
Update the <code>beforeStep()</code> and <code>afterStep()</code> methods as follow (make the necessary changes for the 2nd method).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\t</span><span class="content">** PayrollStepListener:: Step started at: </span><span class="delimiter">&quot;</span></span> + (<span class="keyword">new</span> <span class="predefined-type">Date</span>())
      + <span class="string"><span class="delimiter">&quot;</span><span class="content">; stepContext: </span><span class="delimiter">&quot;</span></span> + stepContext.getBatchStatus());</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure to annotate the class declaration with the <code>@Named</code> annotation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that we have defined the implementation of the listener, we need to update the batch JSL to reference it.
Update the step defined in the JSL as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml">...
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prepare</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollStepListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/listeners&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run the batch, you will see that our 2 listeners are correctly invoked.
You can also notice the listener invokation chain order : <em>job before</em>, <em>step before</em>, <em>step after</em>, <em>job after</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>Info:   ** PayrollJobListener:: Job started at: Thu Jul 31 04:06:39 CEST 2014
Info:   ** PayrollStepListener:: Step started at: Thu Jul 31 04:06:39 CEST 2014; stepContext: STARTED
Info:   ** Calculating net pay for empId: 1
...
Info:   ** Calculating net pay for empId: 5
Info:   ** PayrollStepListener:: Step completed at: Thu Jul 31 04:06:39 CEST 2014; stepContext: STARTED
Info:   ** PayrollJobListener:: Job completed at: Thu Jul 31 04:06:39 CEST 2014; exitStatus : null; STARTED</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_listener_s_within_a_step">4.4. Defining listener(s) within a Step</h3>
<div class="paragraph">
<p>We saw that we can define listeners at the level of a Job and at the level of a Step but this might still be too coarse grained.
JSR 352 also allows to define listeners within a step itself.</p>
</div>
<div class="paragraph">
<p>Before adding this listener, let&#8217;s simulate a use case in the application by adding a record.
Make sure to respect the format expected by the application : int,salary.
For example, fill in "6,10000" and click "add".
You can now launch the job. After you have hit "refresh", the displayed results should includes the record you have just added.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pic/E2.1.png" alt="E2.1">
</div>
<div class="title">Figure 20. Adding a record</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now pretend we did a mistake and add a record using an incorrect format (e.g. "61000").
If you now run the batch again, GlassFish will throw some exceptions as clearly the application can only handle record correctly formated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>Info:   ** Calculating net pay for empId: 4
Info:   ** Calculating net pay for empId: 5
Severe:   Failure in Read-Process-Write Loop
com.ibm.jbatch.container.exception.BatchContainerRuntimeException: java.lang.IllegalArgumentException: Salary cannot be null
...
Warning:   Caught throwable in chunk processing. Attempting to close all readers and writers.
Warning:   Caught exception executing step: com.ibm.jbatch.container.exception.BatchContainerRuntimeException: Failure in Read-Process-Write Loop
...
Caused by: com.ibm.jbatch.container.exception.BatchContainerRuntimeException: java.lang.IllegalArgumentException: Salary cannot be null
...
Caused by: java.lang.IllegalArgumentException: Salary cannot be null
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our step is made of a reader, a processor and a writer.
JSR 352 allows to also define listener at this level, i.e. within a step.
In this example, we will define a listener at the reader level.
Typically, such a listener would be used to intervene and handle any misread data by the reader.</p>
</div>
<div class="paragraph">
<p>In the source directory, create a new java class called "PayrollInputRecordReadListener" and decorate it with the <code>@Named</code> annotation.
As we want a reader at the reader level, we need to implements the <code>javax.batch.api.chunk.listener.ItemReadListener</code> interface, so update your class definition accordingly.
Use NetBeans to implement the abstract methods of the interface.</p>
</div>
<div class="paragraph">
<p>We can inject, in our listener, contexts: the job and the step context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@Inject</span>
   JobContext jobContext;

   <span class="annotation">@Inject</span>
   StepContext stepContext;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can remove the body of the <code>beforeRead()</code> and the <code>afterRead()</code> methods as we won&#8217;t use them.
Change the <code>onReadError()</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onReadError(<span class="exception">Exception</span> ex) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\t</span><span class="content">** PayrollInputRecordReadListener:: onReadError : </span><span class="delimiter">&quot;</span></span>
                + stepContext.getTransientUserData() + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Exception: </span><span class="delimiter">&quot;</span></span> + ex);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your <code>PayrollInputRecordReadListener.java</code> listener should now looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.glassfish.javaee7.batch.lab4</span>;
<span class="keyword">import</span> <span class="include">javax.batch.api.chunk.listener.ItemReadListener</span>;
<span class="keyword">import</span> <span class="include">javax.batch.runtime.context.JobContext</span>;
<span class="keyword">import</span> <span class="include">javax.batch.runtime.context.StepContext</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollInputRecordReadListener</span>
    <span class="directive">implements</span> ItemReadListener {

    <span class="annotation">@Inject</span>
    JobContext jobContext;

    <span class="annotation">@Inject</span>
    StepContext stepContext;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeRead() <span class="directive">throws</span> <span class="exception">Exception</span> {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterRead(<span class="predefined-type">Object</span> item) <span class="directive">throws</span> <span class="exception">Exception</span> {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onReadError(<span class="exception">Exception</span> ex) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\t</span><span class="content">** PayrollInputRecordReadListener:: onReadError : </span><span class="delimiter">&quot;</span></span>
                + stepContext.getTransientUserData() + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Exception: </span><span class="delimiter">&quot;</span></span> + ex);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have defined the listener implementation, we need to configure our job JSL file as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prepare</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;listeners&gt;</span>
            <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReadListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/listeners&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
            <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">netPayProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
            <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollOutputRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you test the batch with a incorrect record, you will notice that the Listener is invoked but you can also see that exceptions are still thrown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>...
Info:   ** Calculating net pay for empId: 4
Info:   ** Calculating net pay for empId: 5
Info:   ** PayrollInputRecordReadListener:: onReadError : null; Exception: java.lang.IllegalArgumentException
Severe:   Failure in Read-Process-Write Loop
com.ibm.jbatch.container.exception.BatchContainerRuntimeException: java.util.NoSuchElementException...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid that, we can define a set of exceptions that can be skipped if they are thrown during the execution of the step.
To do that, define at the step level in the JSL which exception(s) can be skipped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml">   <span class="tag">&lt;skippable-exception-classes&gt;</span>
       <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.IllegalArgumentException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
       <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.NumberFormatException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/skippable-exception-classes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The updated JSL should now looks like this (previous listeners have been removed for shortness, you can keep them):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prepare</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;listeners&gt;</span>
            <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReadListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/listeners&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollInputRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
            <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">netPayProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
            <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payrollOutputRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
            <span class="tag">&lt;skippable-exception-classes&gt;</span>
                <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.IllegalArgumentException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.NumberFormatException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/skippable-exception-classes&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you try again to run the batch job with an incorrect record, you should get the following output in the GlassFish console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>Info:   ** Calculating net pay for empId: 1
Info:   ** Calculating net pay for empId: 2
Info:   ** Calculating net pay for empId: 3
Info:   ** Calculating net pay for empId: 4
Info:   ** Calculating net pay for empId: 5
Info:   ** PayrollInputRecordReadListener:: onReadError : null; Exception: java.lang.IllegalArgumentException: Salary cannot be null</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_4">4.5. Summary</h3>
<div class="paragraph">
<p>In this Lab, we learnt how to define and use listener to intervene within the life-cycle of a batch job.
:imagesdir: ../pic</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_job_partitioning">5. Lab: Job Partitioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, all steps in a job run on the same thread.  Multi-threading can be leveraged to increase throughput and better utilize underlying hardware, that is what <strong>partitioned step</strong> brings. A serially processed step can be broken it into <strong>partitions</strong> that will run on different threads. Once we have defined the partition strategy, the batch runtime will manage the threads and will handle all aspects of checkpoints.</p>
</div>
<div class="sect2">
<h3 id="_set_the_stage_5">5.1. Set the stage</h3>
<div class="paragraph">
<p>We will start from an usual payroll batch job and will enhance it to support partition. Open Lab 5 and launch the <code>PartitionedJobSubmitterServlet.java</code> servlet. In this application, you can select for which month the payroll should be calculated. Don&#8217;t run a batch job at this stage, as it will fails.</p>
</div>
</div>
<div class="sect2">
<h3 id="_define_the_partition_strategy">5.2. Define the partition strategy</h3>
<div class="paragraph">
<p>JSR 352 defines an interface called <code>PartitionMapper</code> (<a href="http://docs.oracle.com/javaee/7/api/javax/batch/api/partition/PartitionMapper.html">javadoc</a>) that provides a programmatic means for calculating the number of partitions and threads for a partitioned step.</p>
</div>
<div class="paragraph">
<p>So create a java classes called "PayrollPartitionMapper", implements the PartitionMapper interface. And as usual, decorate the class with the <code>@Named("PayrollPartitionMapper)</code> annotation, resolve any missing imports and implements the abstract methods imposed by the interface.</p>
</div>
<div class="paragraph">
<p>Inject the JobConext and the SampleDataHolderBean as we will need them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@Inject</span>
   <span class="directive">private</span> JobContext jobContext;

   <span class="annotation">@EJB</span>
   <span class="directive">private</span> SampleDataHolderBean bean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mapPartitions()</code> method return a <code>PartitionPlan</code> object, so let&#8217;s modify the body of the method as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@Override</span>
   <span class="directive">public</span> PartitionPlan mapPartitions() <span class="directive">throws</span> <span class="exception">Exception</span> {

      <span class="keyword">return</span> <span class="keyword">new</span> PartitionPlanImpl() {
          <span class="annotation">@Override</span>
          <span class="directive">public</span> <span class="type">int</span> getPartitions() {
              <span class="keyword">return</span> <span class="integer">5</span>;
          }

          <span class="annotation">@Override</span>
          <span class="directive">public</span> <span class="predefined-type">Properties</span><span class="type">[]</span> getPartitionProperties() {
              <span class="predefined-type">Properties</span> jobParameters = BatchRuntime.getJobOperator().getParameters(jobContext.getExecutionId());

              <span class="predefined-type">String</span> monthYear = (<span class="predefined-type">String</span>) jobParameters.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">monthYear</span><span class="delimiter">&quot;</span></span>);
              <span class="type">int</span> partitionSize = bean.getMaxEmployees() / getPartitions();

              <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">**[PayrollPartitionMapper] jobParameters: </span><span class="delimiter">&quot;</span></span> + jobParameters
              + <span class="string"><span class="delimiter">&quot;</span><span class="content">; executionId: </span><span class="delimiter">&quot;</span></span> + jobContext.getExecutionId() + <span class="string"><span class="delimiter">&quot;</span><span class="content">; partitionSize = </span><span class="delimiter">&quot;</span></span> + partitionSize);

              <span class="predefined-type">Properties</span><span class="type">[]</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>[getPartitions()];
              <span class="keyword">for</span> (<span class="type">int</span> i=<span class="integer">0</span>; i&lt;getPartitions(); i++) {
                <span class="predefined-type">Properties</span> partProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
                partProps.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">monthYear</span><span class="delimiter">&quot;</span></span>, monthYear);
                partProps.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">partitionNumber</span><span class="delimiter">&quot;</span></span>, i);
                partProps.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">startEmpID</span><span class="delimiter">&quot;</span></span>, i * partitionSize);
                partProps.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">endEmpID</span><span class="delimiter">&quot;</span></span>, (i + <span class="integer">1</span>) * partitionSize);

                props[i] = partProps;
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">**[PayrollPartitionMapper[</span><span class="delimiter">&quot;</span></span> + i + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + getPartitions() + <span class="string"><span class="delimiter">&quot;</span><span class="content">] : </span><span class="delimiter">&quot;</span></span> + partProps);
                }

                <span class="keyword">return</span> props;
            }
        };</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the partitioned model, a step is configured to run as multiple instances across multiple threads. Each thread runs the same step. This model can be used in situations where each partition processes a different range of the input items.</p>
</div>
<div class="paragraph">
<p>A partition mapper receives control at the start of a partitioned execution. The partition mapper is responsible to provide unique batch properties for each partition.</p>
</div>
<div class="paragraph">
<p>Our PartitionMapper implementation implements the <code>ParitionMapper</code> interface and returns a PartitionPlan. The PartitionPlan specifies the number of partitions and also returns a <code>java.util.Properties</code> object for each Partition. Each of these Properties object must carry appropriate data that specifies the range of the input items.</p>
</div>
<div class="paragraph">
<p>Our PartionMapper indicates that 5 partitions will be used to do the payroll processing. It then creaes a separate Properties object for each partition and then populates each Properties object with keys "startempID" and "endEmpID" keys that indicate the range of employee IDs that each partition will operate on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_partition_aware_reader">5.3. Partition aware reader</h3>
<div class="paragraph">
<p>If you look at the Chunk&#8217;s reader (<code>SimpleItemReader.java</code>), you will notice that the <code>open()</code> method is slightly different.</p>
</div>
<div class="paragraph">
<p>We have seen how the PartitionMapper creates separate Properties object for each Partition. We also saw that each of these Properties object contains data that specifies the range of data each each partitioned step will operate on.</p>
</div>
<div class="paragraph">
<p>The ItemReader can obtain the partition specific data by calling <code>JobOperator.getParameters(executionId)</code>. The current <code>executionId</code> is obtained by calling <code>jobcontext.getExecutionId()</code> on the injected <code>JobContext</code>. JobContext provides information about the <strong>current</strong> job execution.</p>
</div>
<div class="paragraph">
<p>Once the ItemReader obtains the Properties object containing partition specific data, it finds out the starting and ending employee ID that it should read. It then obtains those <code>PayrollInputRecords</code> from the EJB Singleton bean.</p>
</div>
<div class="paragraph">
<p>The ItemProcessor and ItemWriter thus processes and writes only those payroll records pertaining to the current partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">  <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> e) <span class="directive">throws</span> <span class="exception">Exception</span> {

    <span class="predefined-type">Properties</span> jobParameters = BatchRuntime.getJobOperator().getParameters(jobContext.getExecutionId());
    <span class="predefined-type">String</span> monthYear = (<span class="predefined-type">String</span>) jobParameters.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">monthYear</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">Integer</span> partitionNumber = (<span class="predefined-type">Integer</span>) jobParameters.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">partitionNumber</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">Integer</span> fromKey = (<span class="predefined-type">Integer</span>) jobParameters.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">startEmpID</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">Integer</span> toKey = (<span class="predefined-type">Integer</span>) jobParameters.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">endEmpID</span><span class="delimiter">&quot;</span></span>);

    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleItemReader[partition #</span><span class="delimiter">&quot;</span></span> + partitionNumber + <span class="string"><span class="delimiter">&quot;</span><span class="content"> will process </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> from employeeId: </span><span class="delimiter">&quot;</span></span> + fromKey + <span class="string"><span class="delimiter">&quot;</span><span class="content"> to </span><span class="delimiter">&quot;</span></span> + toKey
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> for the month of </span><span class="delimiter">&quot;</span></span> + monthYear);

    payrollInputRecords = dataBean.getPayrollInputRecords(monthYear, fromKey, toKey);

  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We should also update the JSL to link the partition mapper to the chunk step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">&lt;job id=<span class="string"><span class="delimiter">&quot;</span><span class="content">partitioned-payroll</span><span class="delimiter">&quot;</span></span> xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;step id=<span class="string"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;chunk item-count=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;reader ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleItemReader</span><span class="delimiter">&quot;</span></span>&gt;&lt;/reader&gt;
            &lt;processor ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleItemProcessor</span><span class="delimiter">&quot;</span></span>&gt;&lt;/processor&gt;
            &lt;writer ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleItemWriter</span><span class="delimiter">&quot;</span></span>&gt;&lt;/writer&gt;
        &lt;/chunk&gt;
        &lt;partition&gt;
            &lt;mapper ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollPartitionMapper</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/partition&gt;
    &lt;/step&gt;
&lt;/job&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_partitioned_execution">5.4. Test the partitioned execution</h3>
<div class="paragraph">
<p>If you now run the job for a particular month, you will see in the GlassFish logs that data are spread across 5 threads as defined by the <code>getPartitions()</code> method of the partition mapper. You can also see the data range that each partition is assigned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>Info: ** JobSubmitterServlet: JAN-2013
Info: **[PayrollPartitionMapper] jobParameters: {monthYear=JAN-2013}; executionId: 79; partitionSize = 6
Info: **[PayrollPartitionMapper[0/5] : {endEmpID=6, partitionNumber=0, startEmpID=0, monthYear=JAN-2013}
Info: **[PayrollPartitionMapper[1/5] : {endEmpID=12, partitionNumber=1, startEmpID=6, monthYear=JAN-2013}
Info: **[PayrollPartitionMapper[2/5] : {endEmpID=18, partitionNumber=2, startEmpID=12, monthYear=JAN-2013}
Info: **[PayrollPartitionMapper[3/5] : {endEmpID=24, partitionNumber=3, startEmpID=18, monthYear=JAN-2013}
Info: **[PayrollPartitionMapper[4/5] : {endEmpID=30, partitionNumber=4, startEmpID=24, monthYear=JAN-2013}
Info: SimpleItemReader[partition #2 will process from employeeId: 12 to 18 for the month of JAN-2013
Info: SimpleItemReader[partition #0 will process from employeeId: 0 to 6 for the month of JAN-2013
Info: SimpleItemReader[partition #1 will process from employeeId: 6 to 12 for the month of JAN-2013
Info: SimpleItemReader[partition #4 will process from employeeId: 24 to 30 for the month of JAN-2013
Info: SimpleItemReader[partition #3 will process from employeeId: 18 to 24 for the month of JAN-2013</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_5">5.5. Summary</h3>
<div class="paragraph">
<p>In this Lab, we learnt how to use Partition Mapper to distribute batch processing on different threads.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2014-08-27 08:49:46 CEST
</div>
</div>
</body>
</html>